<main class="container justify-content-around align-items-center m-auto">
  
  <div class="">

      
    <% if current_user.id == params[:id].to_i %>
      <%= button_to 'Edit profile', edit_profile_path(@profile), :method => "get", class:"btn btn-primary" %>
    <% end %>


    <p>
      <strong>Username:</strong>
      <%= @profile.username %>
    </p>
    
    <% if current_user.id == params[:id].to_i %>
      <p>
        <strong>Name:</strong>
        <%= @profile.first_name %> <%= @profile.last_name %>
      </p>
    <% end %>

    <p>
      <strong>Rating:</strong>
    
    </p>
    <p>
      <strong>Avatar:</strong>
      <%= link_to @profile.avatar.filename, @profile.avatar if @profile.avatar.attached? %>
    </p>


  
  </div>

  <div class="seller-listings">
  <h2>
    <% if current_user.profile.id != @profile.id %>
      <%= @profile.username %>'s
    <% else %>
      Your
    <% end %>
    items
  </h2>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Name</th>
          <th>Artist</th>
          <th>Price</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody>
        <% Listing.where(seller: @profile.id).where(status: "For Sale").each do |listing| %>
            <tr>
              <td><%= link_to listing.name.upcase_first, listing %></td>
              <td><%= listing.artist.name.titlecase %></td>
              <td>$<%= number_with_precision(listing.price, precision: 2, :delimiter => ',') %></td>
              <td><%= listing.description.truncate(140) %></td>
            </tr>
        <% end %>
      </tbody>
    </table>

    <% if (current_user.id == @profile.id) && (Listing.where(seller: @profile.id).where(status: "Sold")).present?  %>
      <h2>Your sold items</h2>
      <table class="table table-striped">
      <thead>
        <tr>
          <th>Name</th>
          <th>Artist</th>
          <th>Price</th>
          <th>Details</th>
          <th>Date sold (DD/MM/YY)</th>
        </tr>
      </thead>
      <tbody>
        <% Listing.where(seller: @profile.id).where(status: "Sold").each do |listing| %>
            <tr>
              <td><%= link_to listing.name.upcase_first, listing %></td>
              <td><%= listing.artist.name.titlecase %></td>
              <td>$<%= number_with_precision(listing.price, precision: 2, :delimiter => ',') %></td>
              <td><%= listing.description.truncate(140) %></td>
              <td><%= listing.updated_at.to_time.strftime("%d/%m/%Y") %></td>
            </tr>
        <% end %>
      </tbody>
    </table>
    <%end%>

  </div>
</main>
